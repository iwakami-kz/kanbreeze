# Requirements Document

## Introduction

本システムは、チームの共同作業を支える「プロジェクト／ワークスペース管理」機能を中核とし、親しみ感のある落ち着いた明るい配色で、はじめてのユーザーでも迷わず使える体験を提供する。ワークスペースとプロジェクトのライフサイクル、メンバーと権限、見た目の統一、テンプレート運用、監査・ガバナンスまでを一貫して管理できる。

## Requirments

#### Epic 1: ワークスペース作成・管理

##### Requirment 1
**User Story:** 管理者として、新しいワークスペースを作成したい。チームの活動を一元管理するため。

###### Acceptance Criteria
1. 「作成」操作を行ったとき、システムはワークスペース名の重複を検知し、重複時は作成してはならない。
2. 名称・説明・地域・既定タイムゾーンの入力が完了したとき、システムは1秒以内にワークスペースを作成できなければならない。
3. 作成直後、システムは管理者をオーナーロールで自動割り当てしなければならない。
4. 作成直後、システムは親しみ感のある落ち着いた明るい既定テーマを自動適用しなければならない。
5. 必須項目が未入力のとき、システムは作成してはならない。

##### Requirment 2
**User Story:** 管理者として、ワークスペース設定（名称・説明・ロゴ・テーマ）を編集したい。ブランドと使い勝手を揃えるため。

###### Acceptance Criteria
1. 設定を保存したとき、システムは直後の画面に反映しなければならない。
2. テーマ変更中は、UIプレビューが常にリアルタイムで表示されなければならない。
3. ロゴ画像が規定サイズ・形式外の場合、システムはアップロードを拒否しなければならない。
4. 変更履歴を保存し、いつでも直前の設定にロールバックできなければならない。

##### Requirment 3
**User Story:** 管理者として、ワークスペースを一時停止または削除したい。運用停止や組織変更に備えるため。

###### Acceptance Criteria
1. 一時停止を実行したとき、システムは新規プロジェクト作成と招待を禁止しなければならない。
2. 削除要求を実行したとき、システムは30日間の復元可能期間を設けなければならない。
3. 復元可能期間中、システムは全データを読み取り専用で保持しなければならない。
4. 復元可能期間を経過したとき、システムは不可逆に削除しなければならない。

---

#### Epic 2: プロジェクト作成・管理

##### Requirment 4
**User Story:** プロジェクト管理者として、新規プロジェクトをテンプレートから作成したい。初期設定を省力化するため。

###### Acceptance Criteria
1. テンプレートを選択したとき、システムはカンバン列・ワークフロー・ラベル・権限を初期化しなければならない。
2. 作成時、プロジェクトキーが一意でない場合、作成してはならない。
3. 作成完了後、システムはプロジェクトダッシュボードへ遷移しなければならない。
4. 作成処理は1秒以内で完了しなければならない。

##### Requirment 5
**User Story:** プロジェクト管理者として、プロジェクトのステータスをアクティブ／アーカイブに切り替えたい。運用状況を明確にするため。

###### Acceptance Criteria
1. アーカイブへ変更したとき、システムはチケットの新規作成と編集を禁止し、閲覧のみ許可しなければならない。
2. アクティブへ復帰したとき、システムは直前の権限・設定を復元しなければならない。
3. アーカイブ変更は監査ログに記録されなければならない。

##### Requirment 6
**User Story:** メンバーとして、プロジェクトの概要（目的・進行状況・最近の活動）をひと目で確認したい。状況把握を素早く行うため。

###### Acceptance Criteria
1. プロジェクトトップを表示したとき、システムは直近7日の更新・未完了チケット数・スプリント状況を集約表示しなければならない。
2. ビューの表示は500ms以内で完了しなければならない。
3. ダークモード選択時でも、明るい基調に準じたコントラスト比（WCAG AA）を満たさなければならない。

---

#### Epic 3: メンバー／ロール・権限管理（人／AI／CLI）

##### Requirment 7
**User Story:** 管理者として、ユーザー（人・API経由のLLM・CLIコーディングエージェント）をワークスペースに招待したい。共同作業のため。

###### Acceptance Criteria
1. 招待を送信したとき、システムはロール（オーナー／管理者／メンバー／ゲスト／エージェント）を必須選択にしなければならない。
2. エージェントを招待したとき、システムはトークン権限（読み取り／作成／更新／削除）を細分化して設定できなければならない。
3. 無効なメールや失効トークンの場合、システムは招待を送信してはならない。
4. 招待受諾後、システムは自動的に最小権限原則を適用しなければならない。

##### Requirment 8
**User Story:** 管理者として、プロジェクト単位の権限をロールベースで制御したい。安全に運用するため。

###### Acceptance Criteria
1. プロジェクトにロールを割り当てたとき、システムはアクセス権（閲覧／編集／管理）を即時反映しなければならない。
2. ワークスペースで与えた権限より広い権限をプロジェクトで付与してはならない。
3. ロール定義の変更は、既存メンバーに遡及適用されなければならない。

##### Requirment 9
**User Story:** 監査担当として、AI/CLIエージェントの操作を可視化したい。自動化の安全性を確認するため。

###### Acceptance Criteria
1. エージェントが操作したとき、システムは実行元・時刻・入力要約・結果を監査ログに記録しなければならない。
2. 秘匿情報が含まれる場合、システムは内容をマスキングしなければならない。
3. ログは検索・絞り込み・エクスポートできなければならない。

---

#### Epic 4: 外観・ブランディング（配色／ロゴ／テーマ）

##### Requirment 10
**User Story:** 管理者として、ワークスペース全体のテーマを「親しみ感のある落ち着いた明るい色合い」に統一したい。視認性と心理的安全性を高めるため。

###### Acceptance Criteria
1. テーマ適用時、主要UI要素（ヘッダー／ボタン／カード）が明るい基調で低彩度の配色に切り替わらなければならない。
2. 配色はWCAG AAのコントラスト比を満たさなければならない。
3. テーマはプロジェクト配下にも継承されなければならない。
4. ユーザーは個人設定で上書きできるが、管理者が禁止した場合は上書きしてはならない。

##### Requirment 11
**User Story:** デザイナーとして、ロゴとアクセントカラーを設定したい。ブランド一貫性を保つため。

###### Acceptance Criteria
1. ロゴをアップロードしたとき、システムは自動でライト／ダーク背景の最適プレビューを表示しなければならない。
2. アクセントカラーを選んだとき、システムは可読性が低下する組み合わせを警告しなければならない。
3. 保存後、全ページで即時反映されなければならない。

##### Requirment 12
**User Story:** メンバーとして、ダークモードを選択したい。長時間作業の疲労を軽減するため。

###### Acceptance Criteria
1. ダークモードを有効化したとき、システムは主要色を暗色基調に置換し、アクセントは低刺激で維持しなければならない。
2. モード切替は200ms以内に完了しなければならない。
3. ユーザーの選択はデバイス間で同期されなければならない。

---

#### Epic 5: プロジェクトキー・命名規則と識別子

##### Requirment 13
**User Story:** 管理者として、プロジェクトキーの命名規則を設定したい。チケットIDの一貫性を保つため。

###### Acceptance Criteria
1. 規則を保存したとき、システムは `[A-Z]{2,10}` の正規表現と予約語の一覧を適用できなければならない。
2. 既存キーと重複する場合、作成してはならない。
3. 規則変更時、既存チケットIDの表示は影響してはならない。

##### Requirment 14
**User Story:** PMとして、プロジェクトの表示名とキーを別々に管理したい。読みやすさと安定性を両立するため。

###### Acceptance Criteria
1. 表示名を変更しても、キーが変更されてはならない。
2. キー変更を許可する場合、システムは移行プラン（リダイレクト・検索置換）を自動生成しなければならない。
3. 変更は監査ログに残らなければならない。

##### Requirment 15
**User Story:** 開発者として、チケットID（`プロジェクトキー-採番`）が連番で発行されてほしい。参照を容易にするため。

###### Acceptance Criteria
1. 新規チケット作成時、システムは最小の未使用番号を採番しなければならない。
2. 削除済み番号を再利用してはならない。
3. 高負荷時でも重複採番が発生してはならない。

---

#### Epic 6: テンプレート／初期設定（カンバン・ワークフロー・フィールド）

##### Requirment 16
**User Story:** 管理者として、ワークスペース既定テンプレートを定義したい。統一した運用を実現するため。

###### Acceptance Criteria
1. テンプレートにはカンバン列、ステータス、ラベル、フィールド、権限が含まれていなければならない。
2. 既定テンプレートは新規プロジェクトに自動適用されなければならない。
3. プロジェクト作成時に上書き選択が可能でなければならない。

##### Requirment 17
**User Story:** PMとして、プロジェクト独自テンプレートを保存したい。再利用して立ち上げ時間を短縮するため。

###### Acceptance Criteria
1. 現在の設定から「テンプレートとして保存」したとき、システムは再利用可能なテンプレートを作成しなければならない。
2. テンプレートは権限に応じて共有／非共有を選択できなければならない。
3. バージョンを付与し、更新履歴を保持しなければならない。

##### Requirment 18
**User Story:** 管理者として、必須フィールドや選択肢をワークスペース全体で標準化したい。品質を担保するため。

###### Acceptance Criteria
1. フィールド定義を変更したとき、システムはプロジェクトへ段階的に適用できなければならない。
2. 未対応プロジェクトでは互換レイヤーで表示しなければならない。
3. 非互換な削除は許可してはならない。

---

#### Epic 7: 可視性・アクセス制御とゲスト／共有

##### Requirment 19
**User Story:** プロジェクト管理者として、プロジェクトを公開／非公開／リンク共有に切り替えたい。情報公開範囲を調整するため。

###### Acceptance Criteria
1. 非公開のとき、メンバー以外は一切閲覧できてはならない。
2. リンク共有を有効化したとき、システムは読み取り専用の範囲に限定しなければならない。
3. 公開設定の変更は即時反映され、監査ログに記録されなければならない。

##### Requirment 20
**User Story:** ゲストとして、特定プロジェクトの閲覧だけを許可されたい。外部協力者として関与するため。

###### Acceptance Criteria
1. ゲストは検索・ダウンロード・コメントの可否をロールに従って制限しなければならない。
2. ゲストは他プロジェクトやワークスペース設定にアクセスしてはならない。
3. アクセス期限が切れたとき、自動的に無効化されなければならない。

##### Requirment 21
**User Story:** メンバーとして、プロジェクト内の特定ビュー（レポートやボード）だけを共有したい。情報露出を最小化するため。

###### Acceptance Criteria
1. ビュー共有リンクを発行したとき、閲覧専用トークンが生成されなければならない。
2. 共有範囲外のナビゲーションは無効化されなければならない。
3. 有効期限とパスコードを設定できなければならない。

---

#### Epic 8: 通知・購読・メンション

##### Requirment 22
**User Story:** メンバーとして、プロジェクトの重要イベント（作成・アーカイブ・権限変更）を通知で受け取りたい。見落としを防ぐため。

###### Acceptance Criteria
1. イベントが発生したとき、システムはアプリ内・メールのいずれか／両方で通知できなければならない。
2. 通知頻度（即時・集約・オフ）をユーザーが選択できなければならない。
3. 管理者は強制通知のポリシーを設定できなければならない。

##### Requirment 23
**User Story:** ユーザーとして、ワークスペース単位で購読プロジェクトを管理したい。情報量を適切に保つため。

###### Acceptance Criteria
1. プロジェクトをフォロー／フォロー解除したとき、システムは個人の通知ルールに従って更新しなければならない。
2. 初期状態では、所属プロジェクトのみ自動フォローされなければならない。
3. ミュート期間中は通知してはならない。

##### Requirment 24
**User Story:** メンバーとして、コメントで@メンションされたら確実に気づきたい。対応遅延を防ぐため。

###### Acceptance Criteria
1. メンションされたとき、システムは5秒以内に通知を送信しなければならない。
2. メンションは権限外ユーザーには通知してはならない。
3. 通知から対象箇所へワンクリックで遷移できなければならない。

---

#### Epic 9: 監査・ガバナンス／セキュリティ

##### Requirment 25
**User Story:** 監査担当として、ワークスペースとプロジェクトの操作履歴を検索したい。コンプライアンスのため。

###### Acceptance Criteria
1. ログには対象・操作・実行者・時刻・詳細が含まれていなければならない。
2. 期間・実行者・対象で絞り込み検索できなければならない。
3. ログは90日（標準）／カスタム期間で保持を設定できなければならない。

##### Requirment 26
**User Story:** 管理者として、IP制限と二要素認証を必須化したい。セキュリティを強化するため。

###### Acceptance Criteria
1. 許可IP範囲外のアクセスは拒否されなければならない。
2. 必須化後、未設定ユーザーはログインできてはならない。
3. 例外ポリシーが有効なとき、緊急用アクセス窓口を提示しなければならない。

##### Requirment 27
**User Story:** データ保護担当として、エクスポート時に機密フィールドをマスキングしたい。外部共有のリスクを減らすため。

###### Acceptance Criteria
1. マスキング対象を設定したとき、エクスポート結果に復元可能情報を含めてはならない。
2. マスキングはテンプレートとして保存・再利用できなければならない。
3. エクスポート操作は監査ログに記録されなければならない。

---

#### Epic 10: インポート／エクスポート・移行

##### Requirment 28
**User Story:** 管理者として、Jira/Trello/CSVからプロジェクトをインポートしたい。移行コストを下げるため。

###### Acceptance Criteria
1. マッピング画面でフィールド対応を設定したとき、システムは検証結果を事前に提示しなければならない。
2. 不整合データがある場合、インポートしてはならない。
3. インポート完了後、生成されたプロジェクトキーと件数サマリを表示しなければならない。

##### Requirment 29
**User Story:** PMとして、プロジェクト設定とテンプレートをエクスポートしたい。他ワークスペースへ展開するため。

###### Acceptance Criteria
1. エクスポートにはロール・権限・ワークフロー・ラベル・フィールド定義が含まれていなければならない。
2. エクスポート形式はJSON/YAMLを選択できなければならない。
3. 秘匿値はダミー値に置換されなければならない。

##### Requirment 30
**User Story:** 管理者として、アーカイブ済みプロジェクトを別ワークスペースへ移送したい。組織再編に対応するため。

###### Acceptance Criteria
1. 移送先を選択したとき、システムは権限・テンプレート互換性を検証しなければならない。
2. 互換性がない場合、移送してはならない。
3. 成功時、元プロジェクトはリンク付きでクローズし、移送先で読み取り専用として復元されなければならない。

