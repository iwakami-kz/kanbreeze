
# Requirements Document

## Introduction

本ドキュメントは、プロジェクト管理サービスにおける「個人設定（Personal Settings）」機能の要件を定義する。ユーザーが自分に最適な体験を素早く構築できるよう、プロフィール、見た目（親しみ感のある落ち着いた明るい色合いを含むテーマ）、通知、言語・地域、セキュリティ、連携、作業既定値、データポータビリティを網羅する。

## Requirments

#### Epic 1
**プロフィール & アバター管理**

##### Requirment 1
**User Story:** 一般ユーザーとして、表示名とフルネームを編集したい。チーム内で自分を正しく識別してもらうため。

###### Acceptance Criteria
1. ユーザーが表示名を保存した場合、ヘッダー・コメント・チケットの担当者表示に即時反映されなければならない。
2. 表示名は1〜50文字、先頭・末尾の空白はトリムされなければならない。
3. 禁止文字が含まれる場合、保存は拒否され、理由をフィールド下に表示しなければならない。
4. 変更履歴はユーザー自身が閲覧でき、直前の値に1回は戻せなければならない。

##### Requirment 2
**User Story:** 一般ユーザーとして、プロフィール画像をアップロード・トリミングしたい。視覚的に識別されやすくするため。

###### Acceptance Criteria
1. 画像はPNG/JPEG/WebP、最大5MB、最小解像度128×128pxのみ受け付けなければならない。
2. ユーザーが画像をアップロードした場合、円形プレビューが即時表示され、拡大・トリミングを行えなければならない。
3. アップロードに失敗した場合、原因（サイズ超過/形式不正/ネットワーク）を表示し、再試行手段を提示しなければならない。
4. 画像が削除された場合、イニシャルベースの自動アバターに戻らなければならない。

##### Requirment 3
**User Story:** 一般ユーザーとして、自己紹介・役割・所属を記入したい。コラボレーション時に文脈を共有するため。

###### Acceptance Criteria
1. 自己紹介は0〜500文字、Markdownの強調/リンクのみ許可されなければならない。
2. 役割・所属は選択肢（例：PM/デザイナー/エンジニア）と自由記述の両方を提供しなければならない。
3. 保存後、ユーザープロフィールモーダルに即時反映されなければならない。
4. 不適切表現が検出された場合、警告を表示し保存をブロックできなければならない。

##### Requirment 4
**User Story:** 一般ユーザーとして、プロフィール公開範囲（組織内/プロジェクト内/非公開）を制御したい。プライバシーを守るため。

###### Acceptance Criteria
1. 公開範囲の既定は「組織内」に設定されていなければならない。
2. ユーザーが公開範囲を変更した場合、プロフィール取得APIはアクセス主体に応じてフィールドをマスクしなければならない。
3. 非公開の場合、表示名とアバター以外の項目は第三者に表示されてはならない。
4. 変更は監査ログに残り、ユーザーは自分のログを閲覧できなければならない。

---

#### Epic 2
**テーマ & 表示（色・フォント・密度・アクセシビリティ）**

##### Requirment 5
**User Story:** 一般ユーザーとして、「親しみ感のある落ち着いた明るい」プリセットテーマを選びたい。心地よく集中するため。

###### Acceptance Criteria
1. プリセットに「Bright Calm（親しみ・落ち着き・明るさ）」を用意し、主要UIに即時適用されなければならない。
2. 適用前に全画面プレビューが表示され、キャンセルで元の状態に戻らなければならない。
3. テーマはデバイス間で同期されなければならない。
4. テーマ適用により可読性（本文コントラスト比4.5:1以上）が維持されなければならない。

##### Requirment 6
**User Story:** 一般ユーザーとして、カスタム配色を微調整したい。自分の好みに合わせるため。

###### Acceptance Criteria
1. アクセント/背景/強調の3系統の色相・彩度・明度をスライダーで変更できなければならない。
2. コントラストが基準未満の場合、警告を表示し保存をブロックしなければならない。
3. カスタムテーマは最大5件まで保存・名前変更・削除できなければならない。
4. 変更はコンポーネント単位でプレビューされ、適用/取消が1クリックで行えなければならない。

##### Requirment 7
**User Story:** 一般ユーザーとして、ライト/ダーク/OS自動を切り替えたい。環境に合わせるため。

###### Acceptance Criteria
1. OS自動選択時はシステムの外観変更イベントを監視し、即時切替しなければならない。
2. 各モードのコントラスト基準は満たされなければならない。
3. 切替時にアニメーションは200ms以内で完了し、視覚的ちらつきが発生してはならない。
4. モードはログイン前のランディングにも適用されなければならない。

##### Requirment 8
**User Story:** 一般ユーザーとして、フォントサイズと表示密度を調整したい。情報量と可読性のバランスを取るため。

###### Acceptance Criteria
1. フォントサイズは90%/100%/110%/125%から選択できなければならない。
2. 表示密度は「コンパクト/標準/ゆったり」から選べ、リスト・カード・フォームに一貫適用されなければならない。
3. 変更はユーザー単位に保存され、セッション再開時に復元されなければならない。
4. 文字切れ・レイアウト崩れが発生した場合は自動折返しで解消されなければならない。

##### Requirment 9
**User Story:** 色覚多様性のあるユーザーとして、識別しやすい配色モードを有効化したい。誤認識を防ぐため。

###### Acceptance Criteria
1. 赤緑/青黄/全般低彩度向けの3モードを提供しなければならない。
2. 状態の区別は色だけでなくアイコン/パターン/テキストでも表現されなければならない。
3. テスト用プレビューで各状態（成功/注意/警告/情報）が確認できなければならない。
4. 有効化時、既存カスタム色が判別困難な場合は自動補正が適用されなければならない。

##### Requirment 10
**User Story:** 一般ユーザーとして、見た目の変更を一時的に試したい。安全に比較検討するため。

###### Acceptance Criteria
1. 「下書き」状態でテーマ編集を行い、保存までは自分だけに適用されなければならない。
2. 下書きは最大3件まで保持され、セッションをまたいで編集できなければならない。
3. 保存時に差分（追加/変更/削除）が表示され、確認後に確定できなければならない。
4. 破棄時は永続データに影響してはならない。

---

#### Epic 3
**通知 & フォーカス管理**

##### Requirment 11
**User Story:** 一般ユーザーとして、通知チャネル（Web/メール/モバイル/Slack）を選びたい。過不足ない通知を受けるため。

###### Acceptance Criteria
1. チャネルごとにオン/オフとサウンド/バッジ設定ができなければならない。
2. モバイルは登録済みデバイス一覧から個別にオン/オフできなければならない。
3. テスト通知を送信でき、受信結果を画面で確認できなければならない。
4. APIトークンが無効な連携は通知を送信してはならず、復旧手順を提示しなければならない。

##### Requirment 12
**User Story:** 一般ユーザーとして、イベント別に通知を細かく制御したい。重要な更新を逃さないため。

###### Acceptance Criteria
1. 代表イベント（チケット割当/コメント/メンション/ステータス変更/期限切れ）ごとに即時/ダイジェスト/無効を選べなければならない。
2. プロジェクト単位の上書きルールを設定できなければならない。
3. メンションは常に最低1チャネルで受信されなければならない。
4. ルールは優先順位に従って評価され、評価結果がテスターで確認できなければならない。

##### Requirment 13
**User Story:** 一般ユーザーとして、通知ダイジェスト頻度（1日1回/毎週）を設定したい。通知のノイズを抑えるため。

###### Acceptance Criteria
1. ダイジェストの配信時刻はユーザーのタイムゾーンで設定できなければならない。
2. ダイジェストには件数サマリと重要項目上位5件が含まれなければならない。
3. 直近に即時通知で既読の項目はダイジェストに重複表示されてはならない。
4. ダイジェストは手動で「今すぐ送る」操作ができなければならない。

##### Requirment 14
**User Story:** 一般ユーザーとして、フォーカスモード/おやすみモードを使いたい。作業中の集中を守るため。

###### Acceptance Criteria
1. スケジュール（曜日・時間帯）と即時トグルの両方を提供しなければならない。
2. 有効中は通知はバッジのみ、メンションはサイレントにキューされなければならない。
3. 緊急連絡先（最大3件）からのメンションは常にバイパスされなければならない。
4. 終了時にサマリーカードで未処理通知が一覧表示されなければならない。

##### Requirment 15
**User Story:** 一般ユーザーとして、サウンド/振動/バナーの挙動を微調整したい。環境に合わせるため。

###### Acceptance Criteria
1. 音量は0〜100%、再生時間は最大2秒に制限されなければならない。
2. バナーは画面右上に最大5秒表示、ホバー時は延長されなければならない。
3. サイレント中はサウンドが再生されてはならない。
4. プレビュー再生で確認できなければならない。

---

#### Epic 4
**言語・地域・時間設定**

##### Requirment 16
**User Story:** 一般ユーザーとして、UI言語を選びたい。慣れた言語で操作するため。

###### Acceptance Criteria
1. 少なくとも日本語/英語を提供し、即時スイッチできなければならない。
2. ログイン初回はブラウザ言語を推定して提案しなければならない。
3. 未翻訳キーはフォールバック言語で表示されなければならない。
4. 言語変更はユーザー単位で永続化されなければならない。

##### Requirment 17
**User Story:** 一般ユーザーとして、タイムゾーンを設定したい。期日と通知時刻を正しく合わせるため。

###### Acceptance Criteria
1. デフォルトはブラウザから推定したタイムゾーンに設定されなければならない。
2. ユーザーが手動で変更した場合、すべての日時表示とリマインダ計算に即時反映されなければならない。
3. サマータイム地域では自動補正されなければならない。
4. 異常なタイムゾーンが選ばれた場合、警告し保存をブロックしなければならない。

##### Requirment 18
**User Story:** 一般ユーザーとして、日付/時刻フォーマットと週の開始曜日を選びたい。表示を統一するため。

###### Acceptance Criteria
1. 日付は `YYYY/MM/DD`、`DD/MM/YYYY`、`MM/DD/YYYY` を選択できなければならない。
2. 週の開始曜日は月曜/日曜から選べ、ボード・カレンダーに適用されなければならない。
3. 相対表示（例：昨日/3時間前）はホバーで絶対時刻に切り替わらなければならない。
4. 設定はPDF/エクスポートにも反映されなければならない。

##### Requirment 19
**User Story:** 日本のユーザーとして、日本の祝日カレンダーを有効化したい。計画時に考慮するため。

###### Acceptance Criteria
1. 有効化時、スプリント計画と期限入力で祝日がハイライトされなければならない。
2. 祝日はカレンダーコンポーネントのツールチップで名称が表示されなければならない。
3. 祝日が移動・追加された場合でも翌セッションで更新されなければならない。
4. 祝日ハイライトは印刷にも反映されなければならない。

---

#### Epic 5
**セキュリティ & プライバシー**

##### Requirment 20
**User Story:** 一般ユーザーとして、パスワードを変更したい。アカウントを保護するため。

###### Acceptance Criteria
1. 旧パスワードの確認と複雑性要件（長さ12以上、文字種3種類以上）を満たさなければならない。
2. 変更後、他の全セッションは失効しなければならない（現在セッションは維持を選択可）。
3. 過去5回と同一のパスワードは使用できてはならない。
4. 成功・失敗は明確なメッセージで通知されなければならない。

##### Requirment 21
**User Story:** 一般ユーザーとして、二要素認証（TOTP/SMS）を設定したい。不正アクセスを防ぐため。

###### Acceptance Criteria
1. TOTPはQRコードで登録でき、バックアップコード（10個）が発行されなければならない。
2. SMSはE.164形式の番号で登録し、テストコードで確認できなければならない。
3. 回復手段が未設定の場合、2FAの有効化は完了できてはならない。
4. 新しい端末ログイン時は2FAが必須でなければならない。

##### Requirment 22
**User Story:** 一般ユーザーとして、アクティブセッションを確認・無効化したい。盗用を検知するため。

###### Acceptance Criteria
1. デバイス名/ブラウザ/最終アクセス/位置情報（市区町村）が一覧表示されなければならない。
2. 任意のセッションを手動で無効化でき、即時にトークンが失効しなければならない。
3. 異常な場所のログイン検出時は通知し、ワンクリックで全セッション無効化できなければならない。
4. 一覧は直近30日分を保持しなければならない。

##### Requirment 23
**User Story:** 一般ユーザーとして、オンライン状態や既読表示の公開範囲を制御したい。プライバシーを守るため。

###### Acceptance Criteria
1. 「全員/チームのみ/非公開」から選択できなければならない。
2. 非公開時は他者からオンライン/既読/入力中が表示されてはならない。
3. 変更はメッセージング/コメントに即時反映されなければならない。
4. 既定は「チームのみ」でなければならない。

##### Requirment 24
**User Story:** 開発者として、個人アクセストークンを発行・失効したい。API連携のため。

###### Acceptance Criteria
1. トークンは説明・権限・有効期限を指定して発行できなければならない。
2. トークン値は発行時のみ表示され、以後はマスクされなければならない。
3. 任意のトークンを即時失効でき、履歴に残らなければならない。
4. 有効期限切れのトークンは自動で無効化されなければならない。

---

#### Epic 6
**連携 & アプリ**

##### Requirment 25
**User Story:** 一般ユーザーとして、Slack通知連携を接続・切断したい。チームの通知経路を統一するため。

###### Acceptance Criteria
1. OAuthフローで権限付与後、通知チャネルにSlackが選択可能にならなければならない。
2. 切断時はWebフックとトークンが削除され、通知は送信されてはならない。
3. 接続テストメッセージが成功/失敗を示さなければならない。
4. ワークスペース/チャンネルは複数登録でき、優先順位を並び替えられなければならない。

##### Requirment 26
**User Story:** 開発者として、GitHub/GitLabとリンクしたい。コミットやPRをチケットに自動紐付けするため。

###### Acceptance Criteria
1. コミットメッセージに「PROJECT-123」形式が含まれる場合、該当チケットにリンクが追加されなければならない。
2. PR/マージイベントはチケットの履歴に反映されなければならない。
3. 連携はユーザー単位でオン/オフでき、権限が不足する場合はエラーを表示しなければならない。
4. 手動再同期で直近100イベントを再取り込みできなければならない。

##### Requirment 27
**User Story:** 一般ユーザーとして、Googleカレンダー連携を設定したい。期限と予定を一元管理するため。

###### Acceptance Criteria
1. 期限付きチケットを専用カレンダーに出力でき、更新は5分以内に反映されなければならない。
2. プロジェクトごとの出力オン/オフが設定できなければならない。
3. 読み取り専用/双方向を選択でき、双方向時は外部で変更された件名・期日がチケットに反映されなければならない。
4. 連携解除時はカレンダー項目の更新を停止しなければならない。

##### Requirment 28
**User Story:** 開発者として、Webhookを管理したい。イベントを外部システムに通知するため。

###### Acceptance Criteria
1. URL・シークレット・対象イベントを設定し、テスト送信で署名ヘッダを確認できなければならない。
2. 連続失敗（3回）時は自動一時停止され、ユーザーに通知されなければならない。
3. 配送履歴（200/4xx/5xx）を50件保持し、再送信できなければならない。
4. 機密情報はログに記録されてはならない。

##### Requirment 29
**User Story:** 一般ユーザーとして、モバイル端末を通知デバイスとして登録/解除したい。出先でも見逃さないため。

###### Acceptance Criteria
1. 端末名/OS/最終受信日時が一覧表示されなければならない。
2. 端末ごとに通知オン/オフとサイレント時間帯を設定できなければならない。
3. 解除時はトークンが即時無効化されなければならない。
4. 同一端末の重複登録は防止されなければならない。

---

#### Epic 7
**作業既定値 & 表示設定**

##### Requirment 30
**User Story:** 一般ユーザーとして、既定のプロジェクト/ボード/スプリントを設定したい。毎日の導線を短縮するため。

###### Acceptance Criteria
1. ログイン後の着地点として既定プロジェクト/ボード/スプリントが開かれなければならない。
2. プロジェクトにアクセス権が失われた場合、既定は自動解除され、ユーザーに通知されなければならない。
3. 既定はクイック切替で一時上書きできなければならない。
4. 設定はデバイス間で同期されなければならない。

##### Requirment 31
**User Story:** 一般ユーザーとして、チケットリストの列表示/並び順を保存したい。自分用の見やすさを保つため。

###### Acceptance Criteria
1. 列の表示/非表示と順序・幅が保存され、再訪時に復元されなければならない。
2. ビューは最大10件までプリセットとして保存・共有（閲覧のみ）できなければならない。
3. 必須列（ID/件名）は非表示にできてはならない。
4. 保存時に現在のフィルター条件も一緒に保存されなければならない。

##### Requirment 32
**User Story:** 一般ユーザーとして、カンバンカードの情報密度とバッジ表示を調整したい。状態把握を素早くするため。

###### Acceptance Criteria
1. バッジ（期限/担当/ラベル/コメント数）のオン/オフを個別に切替できなければならない。
2. 密度はEpic 2の表示密度と連動し、カード高さが即時更新されなければならない。
3. 変更は現在ボードにのみ適用/全ボードに適用を選択できなければならない。
4. パフォーマンスは1,000カード表示時でもフレーム落ちが許容範囲内でなければならない。

##### Requirment 33
**User Story:** 一般ユーザーとして、キーボードショートカットの割当をカスタマイズしたい。操作効率を高めるため。

###### Acceptance Criteria
1. 衝突する割当は保存できてはならない（警告表示）。
2. プリセット（標準/VSCode風/Jira風）から選択し、個別上書きができなければならない。
3. 無効化したショートカットはヘルプオーバーレイに表示されてはならない。
4. 変更は即時にグローバルナビと主要画面に反映されなければならない。

##### Requirment 34
**User Story:** 一般ユーザーとして、既定フィルター（自分の担当/期限今週など）を保存したい。毎回の検索を減らすため。

###### Acceptance Criteria
1. 任意の検索条件を名前付きフィルターとして保存・並び替えできなければならない。
2. 保存したフィルターはクイックアクセスに表示され、ショートカット割当が可能でなければならない。
3. 共有時は読み取り専用で他者が利用できなければならない。
4. 存在しないラベルやプロジェクトが条件に含まれる場合、警告し自動で除外しなければならない。

---

#### Epic 8
**データポータビリティ & リセット**

##### Requirment 35
**User Story:** 一般ユーザーとして、個人設定をエクスポート/インポートしたい。新しい環境へ移行するため。

###### Acceptance Criteria
1. JSON形式で全設定（機密除く）をダウンロードできなければならない。
2. インポート時は差分プレビューを表示し、適用範囲を選択できなければならない。
3. 不正なフォーマットはエラーを表示し、適用されてはならない。
4. 機密項目（トークン/パスワード）は含めてはならない。

##### Requirment 36
**User Story:** 一般ユーザーとして、設定の変更履歴を確認・ロールバックしたい。誤操作を回復するため。

###### Acceptance Criteria
1. 主要カテゴリ単位で直近30日の履歴が一覧表示されなければならない。
2. 任意の時点にロールバックでき、影響範囲が事前表示されなければならない。
3. ロールバックは取り消し（Undo）可能でなければならない。
4. 履歴には実施者・日時・差分が含まれなければならない。

##### Requirment 37
**User Story:** 一般ユーザーとして、設定を初期状態にリセットしたい。環境を整理するため。

###### Acceptance Criteria
1. 全体/カテゴリ単位のリセットを提供し、確認ダイアログで影響範囲を明示しなければならない。
2. リセット後は初回チュートリアルが再表示されなければならない。
3. リセットは1回限り取り消し可能である必要がある。
4. 共有プリセットや他者に影響する設定はリセット対象に含めてはならない。

##### Requirment 38
**User Story:** 一般ユーザーとして、複数デバイス間で設定を同期したい。体験を一貫させるため。

###### Acceptance Criteria
1. デバイス追加時に最新のクラウド設定が適用されなければならない。
2. オフライン変更は次回オンライン時にマージされ、競合はユーザーに解決手段（上書き/併合）を提示しなければならない。
3. 同期の最終時刻が表示されなければならない。
4. セキュアでないネットワークでは同期が保留されなければならない。

##### Requirment 39
**User Story:** 一般ユーザーとして、自分の設定変更の監査ログを閲覧したい。問題の原因追跡のため。

###### Acceptance Criteria
1. 対象・操作・結果・IP/UA・トレーサビリティIDが表示されなければならない。
2. 絞り込み（期間/カテゴリ/結果）とCSVエクスポートができなければならない。
3. 機密値はマスクされ、復元されてはならない。
4. 監査ログは本人のみ閲覧可能でなければならない。

