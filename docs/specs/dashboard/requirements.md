# Requirements Document

## Introduction

本ドキュメントは、プロジェクト管理サービスの「ダッシュボード」機能に関する要件定義書です。  
ユーザーが日々の状況と優先度を迷いなく把握できることを目的に、親しみ感がありつつ落ち着いた明るい色合い（安心感・視認性・軽やかさ）のUIを前提とした設計指針、機能要求、受け入れ基準（EARS表記）を示します。

## Requirments

#### Epic 1: ダッシュボードの基本構造とホーム体験

##### Requirment 1
**User Story:** プロジェクトメンバーとして、ログイン後にホームダッシュボードで自分に関係する情報をひと目で把握したい。意思決定と着手を素早く行うためだ。

###### Acceptance Criteria
1. ユーザーがログインした場合、システムはユーザーのロール・直近アクティビティを元に「マイタスク」「期日が近い項目」「未読のメンション」を最上部に表示しなければならない。
2. ダッシュボードが表示される間、主要指標（進捗率、未完了数、期日超過数）のKPIカードを3〜6個表示しなければならない。
3. 初回訪問時、システムはデフォルトレイアウトを適用し、以降は保存レイアウトを自動で復元しなければならない。
4. ネットワーク遅延がある場合、システムはレイアウト崩れを避けるためスケルトンUIを表示しなければならない。

##### Requirment 2
**User Story:** スクラムマスターとして、スプリントの全体状況をダッシュボードで一望したい。日次のスタンドアップを効率化するためだ。

###### Acceptance Criteria
1. スプリントが進行中の場合、システムは残日、コミットポイント、完了ポイント、バーンダウンのスパークラインを表示しなければならない。
2. スプリントが未設定の場合、システムは設定導線（作成ボタンとヘルプ）を提示しなければならない。
3. スプリントが終了した場合、システムは「レビューへ」リンクと実績サマリーを表示しなければならない。

##### Requirment 3
**User Story:** プロダクトマネージャーとして、複数プロジェクトの横断サマリーを1画面で比較したい。投資配分とリスクを評価するためだ。

###### Acceptance Criteria
1. 複数プロジェクトが選択された場合、システムはプロジェクトごとの進捗・リスク・リソース使用率をカードの同一レイアウトで並べて表示しなければならない。
2. 権限が不足するプロジェクトについて、システムは非表示とし、件数のみ「閲覧権限なし」と集計表示しなければならない。
3. いずれのカードもクリックした場合、対応するプロジェクト詳細へ遷移できなければならない。

##### Requirment 4
**User Story:** 一般ユーザーとして、セクションを折りたたみ/展開できるようにしたい。自分の関心に合わせて情報密度を調整するためだ。

###### Acceptance Criteria
1. ユーザーがセクションヘッダを操作した場合、システムは0.2〜0.3秒のアニメーションで開閉しなければならない。
2. 開閉状態はユーザー単位で保存・復元されなければならない。
3. セクションが閉じている場合、重要な未読件数バッジは常に表示されなければならない。

##### Requirment 5
**User Story:** ゲストユーザーとして、許可された情報だけが見えるようにしたい。情報漏えいを防ぐためだ。

###### Acceptance Criteria
1. ユーザーのロールがゲストである場合、システムはチケット内容の詳細を伏せ字または件数・指標のみで表示しなければならない。
2. 権限のないリンクを踏んだ場合、システムはアクセス拒否を返しつつ、申請導線を表示しなければならない。
3. 非公開タグが付与されたウィジェットはレンダリングしてはならない。

---

#### Epic 2: ウィジェット（カード）の追加・配置・レイアウト

##### Requirment 6
**User Story:** ユーザーとして、ダッシュボードにウィジェットを追加/削除したい。自分の業務に最適化するためだ。

###### Acceptance Criteria
1. ユーザーが「ウィジェット追加」を選択した場合、システムは検索可能なギャラリー（プレビュー付き）を表示しなければならない。
2. 追加されたウィジェットは即時にグリッドへ配置されなければならない。
3. ユーザーが削除を実行した場合、システムは取り消し（5秒）を提供しなければならない。

##### Requirment 7
**User Story:** ユーザーとして、カードのドラッグ&ドロップで並び替えたい。視線移動を最小化するためだ。

###### Acceptance Criteria
1. ドラッグ中、システムはスナップグリッドで空き枠のプレビューを表示しなければならない。
2. 並び替え完了時、システムは新しい順序を永続化しなければならない。
3. キーボード操作時、矢印キーでフォーカス移動と位置交換が可能でなければならない。

##### Requirment 8
**User Story:** ユーザーとして、ウィジェットのサイズを変更したい。情報量に応じて柔軟にしたいためだ。

###### Acceptance Criteria
1. 4通り以上のサイズ（S/M/L/XL）を提供しなければならない。
2. サイズ変更中、内容はレスポンシブに再配置されなければならない。
3. 最小サイズを下回る場合、システムはタイトル・主要指標のみのコンパクト表示に切り替えなければならない。

##### Requirment 9
**User Story:** 管理者として、推奨レイアウトのプリセットを配布したい。チームで統一の見え方を保つためだ。

###### Acceptance Criteria
1. 管理者がプリセットを公開した場合、チームメンバーは適用/比較/差分マージができなければならない。
2. プリセット適用時、ユーザーのカスタムは上書きせず差分のみ反映しなければならない。
3. プリセットが更新された場合、システムは更新通知と変更点サマリーを表示しなければならない。

##### Requirment 10
**User Story:** 管理者として、ウィジェットの利用制限を設定したい。契約や権限に応じて機能を制御するためだ。

###### Acceptance Criteria
1. 契約プランが制限付きの場合、システムは利用不可のウィジェットにロック表示を行わなければならない。
2. 権限が不足する場合、ウィジェットは非表示または縮退表示（数値のみ）にしなければならない。
3. 監査ログは、追加/削除/並び替え/サイズ変更の操作を記録しなければならない。

---

#### Epic 3: 可視化とインサイト（チケット/スプリント/カンバン）

##### Requirment 11
**User Story:** スクラムマスターとして、バーンダウン/バーンアップ/累積フローを見たい。進捗の傾向を把握するためだ。

###### Acceptance Criteria
1. スプリントが存在する場合、システムは期間選択に応じた3種のチャートを表示しなければならない。
2. データが欠損している場合、システムは欠損区間を明示し、外挿してはならない。
3. ズーム/範囲選択を行った場合、チャートはインタラクティブに再描画されなければならない。

##### Requirment 12
**User Story:** エンジニアリングマネージャーとして、WIP・リードタイム・サイクルタイムを指標カードで確認したい。ボトルネックを特定するためだ。

###### Acceptance Criteria
1. カンバンの各レーンが存在する間、WIP上限と現在値を比較し、閾値超過を警告表示しなければならない。
2. リードタイム/サイクルタイムは中央値・90%点・サンプル数を同時に表示しなければならない。
3. フィルタが適用された場合、指標は即時に再計算されなければならない。

##### Requirment 13
**User Story:** QAとして、期日超過チケットを一覧し、担当者別に集計を見たい。是正アクションをとるためだ。

###### Acceptance Criteria
1. 期日が過去で未完了の場合、システムは「超過」バッジと超過日数を表示しなければならない。
2. 集計表は担当者別・ラベル別の切替が可能でなければならない。
3. エクスポート時、現在のフィルタ条件をメタ情報として同梱しなければならない。

##### Requirment 14
**User Story:** デザイナーとして、コメントの活発度や未返信コメントを把握したい。コミュニケーションの滞留を防ぐためだ。

###### Acceptance Criteria
1. コメントが24時間未返信の場合、システムは「要返信」リストに自動で追加しなければならない。
2. 週次のコメント数とスレッド継続時間のトレンドを可視化しなければならない。
3. メンションを受けた場合、未読数をダッシュボード上部に反映しなければならない。

##### Requirment 15
**User Story:** プロダクトオーナーとして、バックログ健全性（未見積/未優先度/古い項目）を見たい。改善の優先度を判断するためだ。

###### Acceptance Criteria
1. 未見積のアイテムが存在する場合、システムは件数と上位5件の詳細リンクを表示しなければならない。
2. 最終更新が30日を超える項目は「陳腐化」指標に集計しなければならない。
3. 優先度未設定項目の割合が20%を超えた場合、警告を表示しなければならない。

---

#### Epic 4: テーマ＆ビジュアル言語（親しみ感のある落ち着いた明るい色合い）

##### Requirment 16
**User Story:** すべてのユーザーとして、親しみ感のある落ち着いた明るい色合いのテーマを選びたい。疲れにくく安心して使うためだ。

###### Acceptance Criteria
1. システムは「Soft Light」「Warm Pastel」「Calm Mint」等の明度高め・彩度控えめのテーマを3種以上提供しなければならない。
2. テキストと背景のコントラスト比は最小でもWCAG AA（4.5:1）を満たさなければならない。
3. 強調色は背景に対し最小3:1のコントラストを満たし、点滅や過度な彩度を使用してはならない。

##### Requirment 17
**User Story:** ユーザーとして、ライト/ダーク/ハイコントラストを切り替えたい。使用環境に合わせるためだ。

###### Acceptance Criteria
1. OSのカラースキームが変更された場合、システムは自動でテーマを追従する設定を提供しなければならない。
2. ハイコントラスト有効時、装飾的な背景は抑制され、境界線は明瞭でなければならない。
3. モード切替は0.2〜0.3秒でアニメーションし、内容の再読み込みを要求してはならない。

##### Requirment 18
**User Story:** デザインリードとして、ビジュアルの一貫性を保ちたい。スケールしやすいデザインシステムのためだ。

###### Acceptance Criteria
1. システムは色のデザイントークン（semantic: primary/secondary/surface/ info/success/warning/danger）を定義しなければならない。
2. コンポーネントは8ptグリッド、角丸（4/8/12）の段階を用いなければならない。
3. フォーカスリングは全テーマで視認可能なスタイルを用い、非表示としてはならない。

##### Requirment 19
**User Story:** ユーザーとして、モーションが穏やかなUIを望む。落ち着いた体験を損なわないためだ。

###### Acceptance Criteria
1. アニメーションのデフォルト所要時間は200〜300msとしなければならない。
2. OSの「動きを減らす」が有効な場合、装飾的アニメーションは無効化しなければならない。
3. トランジションはフェード/スライドの低振幅のみを使用し、フラッシュや急激なズームを使用してはならない。

##### Requirment 20
**User Story:** 管理者として、ブランドカラーをテーマに反映したい。企業のトーン&マナーを維持するためだ。

###### Acceptance Criteria
1. ブランド用カスタムパレットが設定された場合、システムはコントラストを自動検証し、基準未満の組み合わせを許可してはならない。
2. ロゴ背景とヘッダーは自動で調和色（類似色/補色）を提案しなければならない。
3. カスタムテーマはテナント単位で保存・配布できなければならない。

---

#### Epic 5: 通知・アラート・インボックス

##### Requirment 21
**User Story:** メンバーとして、重要通知を見逃さないインボックスが欲しい。優先度の高い対応を遅らせないためだ。

###### Acceptance Criteria
1. 期日接近（48/24/4時間）、メンション、レビュー依頼のイベントが発生した場合、システムはインボックスへ即時に追加しなければならない。
2. 既読操作が行われた場合、通知バッジ数を即時に更新しなければならない。
3. 通知はプロジェクト/種類/重要度でフィルタ可能でなければならない。

##### Requirment 22
**User Story:** ユーザーとして、不要な通知はミュートしたい。集中を妨げないためだ。

###### Acceptance Criteria
1. ユーザーが通知種類をミュート設定した場合、システムは指定期間中該当通知を配信してはならない。
2. ミュート解除時、システムは抑制されていた通知のサマリーのみを提示しなければならない。
3. 重大アラート（SLA違反・セキュリティ）はミュート設定の対象外でなければならない。

##### Requirment 23
**User Story:** リーダーとして、重大な状態変化をダッシュボードに明示してほしい。迅速な対処のためだ。

###### Acceptance Criteria
1. 重大アラートが存在する場合、システムはダッシュボード上部にステータスバナーを表示しなければならない。
2. アラート解消後、システムはバナーを自動で閉じ、履歴に記録しなければならない。
3. アラートクリック時、原因と推奨アクションを表示しなければならない。

##### Requirment 24
**User Story:** チームとして、日次ダイジェストを受け取りたい。欠落を防ぐためだ。

###### Acceptance Criteria
1. 指定時刻になると、システムは当日の変更点（進捗、超過、コメント、ブロッカー）をまとめたダイジェストを生成しなければならない。
2. 受信チャネル（メール/チャット連携）はユーザー単位で選択できなければならない。
3. ダイジェストに含めるウィジェットは選択式でなければならない。

---

#### Epic 6: 検索・フィルタ・クイック操作

##### Requirment 25
**User Story:** ユーザーとして、ダッシュボードから横断検索を行いたい。必要情報へ最短で到達するためだ。

###### Acceptance Criteria
1. 検索バーにテキスト入力がある場合、システムはチケット/コメント/ユーザー/ドキュメントを横断で提案しなければならない。
2. 検索はキーボードのみで完結できなければならない（Enterで確定、矢印で選択）。
3. 検索クエリは最近の5件を履歴として保存しなければならない。

##### Requirment 26
**User Story:** ユーザーとして、フィルタを保存して再利用したい。定常視点を素早く呼び出すためだ。

###### Acceptance Criteria
1. フィルタが適用された場合、システムはURLにクエリとして埋め込み、共有可能にしなければならない。
2. 保存フィルタは名称・説明・公開範囲を設定できなければならない。
3. 保存フィルタが更新された場合、利用者に差分内容を通知しなければならない。

##### Requirment 27
**User Story:** ユーザーとして、コマンドパレットから「チケット作成」などのクイック操作を行いたい。画面遷移を減らすためだ。

###### Acceptance Criteria
1. ユーザーがショートカット（例: ⌘/Ctrl+K）を押下した場合、システムはコマンドパレットを開かなければならない。
2. 「新規チケット」「スプリント切替」「ラベル付与」等のアクションが即時に実行できなければならない。
3. 権限制御はコマンド候補レベルで適用され、実行不可のコマンドを表示してはならない。

##### Requirment 28
**User Story:** 利用者として、期間・担当・ラベルなど代表的なフィルタを素早く切り替えたい。確認の手間を減らすためだ。

###### Acceptance Criteria
1. システムは「今週/今月/スプリント期間」のクイック期間を提供しなければならない。
2. 担当者・ラベルは多選択チップで表示され、選択状態が視覚的に明確でなければならない。
3. フィルタ適用中は、KPIカード/グラフ/リストの全てが同じ条件で同期されなければならない。

##### Requirment 29
**User Story:** 管理者として、検索とフィルタのパフォーマンスを保障したい。ユーザー体験を損ねないためだ。

###### Acceptance Criteria
1. インデックスが更新された場合、システムは10分以内に検索結果へ反映しなければならない。
2. 検索応答時間はP95で1.0秒以下でなければならない。
3. エラーが発生した場合、ユーザーに再試行と問い合わせ導線を提示しなければならない。

---

#### Epic 7: 共有・エクスポート・配信

##### Requirment 30
**User Story:** ステークホルダーとして、ダッシュボードを読み取り専用で共有したい。進捗の透明性を確保するためだ。

###### Acceptance Criteria
1. 共有リンクが作成された場合、システムは有効期限・パスワード・IP制限を設定可能にしなければならない。
2. 共有リンクでは編集機能を表示してはならない。
3. 共有状態は監査ログに記録されなければならない。

##### Requirment 31
**User Story:** ユーザーとして、スナップショットを画像/PDFにエクスポートしたい。報告資料に利用するためだ。

###### Acceptance Criteria
1. エクスポート実行時、システムは現在のフィルタ・日付・ユーザー名をフッタに自動で記載しなければならない。
2. 背景色と文字は印刷向けコントラストに最適化されなければならない。
3. 非公開情報はエクスポートに含めてはならない。

##### Requirment 32
**User Story:** マネージャーとして、定期的にダッシュボードのPDFをメール配信したい。会議準備を省力化するためだ。

###### Acceptance Criteria
1. 指定の曜日・時刻になると、システムはPDFを生成し、配信リストに送信しなければならない。
2. 配信に失敗した場合、再送と失敗通知を行わなければならない。
3. 各受信者の権限に応じて内容をマスキングしなければならない。

##### Requirment 33
**User Story:** 広報として、ダッシュボードの一部をWebに埋め込みたい。社外への情報公開のためだ。

###### Acceptance Criteria
1. 埋め込み用ウィジェットは読み取り専用で、署名付きトークンが有効な間のみ表示されなければならない。
2. トークンが失効した場合、ウィジェットは表示してはならない。
3. 外部ドメインからの読み込み時、CSPとX-Frame-Optionsを適切に設定しなければならない。

##### Requirment 34
**User Story:** ユーザーとして、CSVで集計データを取り出したい。独自分析に利用するためだ。

###### Acceptance Criteria
1. エクスポート対象が選択された場合、システムは列定義とサンプルを事前に表示しなければならない。
2. 日付はISO 8601、数値は小数点/桁区切りの地域設定に準拠しなければならない。
3. 10万行を超える場合、ページングまたは分割ダウンロードを提供しなければならない。

---

#### Epic 8: パフォーマンス・セキュリティ・アクセシビリティ・レスポンシブ

##### Requirment 35
**User Story:** すべてのユーザーとして、ダッシュボードが高速に開いてほしい。ストレスなく使うためだ。

###### Acceptance Criteria
1. 初回ペイントは2秒以内、インタラクティブまで4秒以内（P75）でなければならない。
2. ウィジェットは優先度順に遅延読み込みしなければならない。
3. 画像・アイコンは最適化（WebP/SVG）されなければならない。

##### Requirment 36
**User Story:** セキュリティ担当として、権限に応じたデータ保護を担保したい。情報漏えいを防ぐためだ。

###### Acceptance Criteria
1. すべてのデータ取得はRBACを通過しなければならない。
2. テナント間のデータは論理的に分離され、URL推測によるアクセスを許可してはならない。
3. 個人情報が表示される場合、マスキングポリシーを適用しなければならない。

##### Requirment 37
**User Story:** アクセシビリティ配慮が必要なユーザーとして、キーボードとスクリーンリーダーで快適に操作したい。誰もが使えるためだ。

###### Acceptance Criteria
1. すべての操作はキーボードのみで完結できなければならない（フォーカス可視・順序論理的）。
2. ランドマーク/ARIA属性/代替テキストが適切に付与されなければならない。
3. カラーブラインド配慮として、色以外の表現（パターン/アイコン/ラベル）を併用しなければならない。

##### Requirment 38
**User Story:** 現場メンバーとして、モバイルでも見やすいダッシュボードがほしい。移動中に状況確認するためだ。

###### Acceptance Criteria
1. ビューポート幅に応じ、カードは1列（モバイル）/2列（タブレット）/3列以上（デスクトップ）に自動再配置されなければならない。
2. モバイルではグラフはスパークラインと主要数値の簡易表示に縮退できなければならない。
3. 重要操作は48px以上のタップ領域を確保しなければならない。

##### Requirment 39
**User Story:** 信頼性担当として、データの鮮度を保証したい。意思決定の精度を保つためだ。

###### Acceptance Criteria
1. リアルタイム更新が可能な場合、システムはWebSocket/SSEで差分更新を行わなければならない。
2. データソースが失敗した場合、最終更新時刻とフォールバック表示を明示しなければならない。
3. チャートやKPIには「最終更新」タイムスタンプを表示しなければならない。

##### Requirment 40
**User Story:** 運用者として、障害時の影響範囲を迅速に把握したい。復旧時間を短縮するためだ。

###### Acceptance Criteria
1. バックエンドのヘルスチェックが失敗した場合、システムは「サービス状態」ウィジェットに自動反映しなければならない。
2. 重大障害が発生した場合、ステータスページへのリンクと更新履歴を表示しなければならない。
3. 復旧後、影響期間と再発防止策のメモを添えてアナウンスを掲出しなければならない。

