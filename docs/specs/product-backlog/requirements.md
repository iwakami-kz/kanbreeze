# Requirements Document

## Introduction

本要件は、プロジェクト管理サービスにおける「プロダクトバックログ」機能を定義する。ユーザーが親しみやすく、落ち着きのある明るい色合いのUIで、価値・優先度・見積りを一貫して扱える体験を提供することを目的とする。視覚的な安心感と操作の分かりやすさを重視し、アクセシビリティとコラボレーションを両立する。

## Requirments

#### Epic 1
バックログ項目の作成・編集・表示

##### Requirment 1
**User Story:** プロダクトマネージャーとして、バックログ項目を最小入力で素早く作成できる。入力負荷を減らしてアイデアを逃さないため。

###### Acceptance Criteria
1. ユーザーがタイトルのみ入力して保存した場合、項目はドラフトとして作成され、一覧に即時表示されなければならない。
2. タイトルが未入力の場合、保存操作は受け付けられてはならない。
3. 保存中は進行中インジケーターが表示され、保存成功時は穏やかなトーンの確認トーストが2秒以内に表示されなければならない。
4. ネットワーク断が発生した場合、ローカル下書きに自動保存され、再接続時に送信を再試行しなければならない。

##### Requirment 2
**User Story:** プロダクトマネージャーとして、項目の詳細（説明、カテゴリ、担当、期日、色ラベル）を編集できる。情報を正確に伝えるため。

###### Acceptance Criteria
1. 詳細パネルの各フィールドはインライン編集に対応し、フォーカス外れ時に自動保存されなければならない。
2. 期日はカレンダーピッカーで選択でき、過去日を選択した場合は穏やかな警告で確認が求められなければならない。
3. 色ラベルは製品既定のパレットからのみ選択でき、自由入力はできてはならない。
4. 編集履歴はユーザー・時刻・変更差分を保持し、最新10件が表示できなければならない。

##### Requirment 3
**User Story:** 開発者として、Markdownで技術的背景やメモを記述できる。共有理解を高めるため。

###### Acceptance Criteria
1. 説明フィールドはMarkdownプレビューを提供し、見出し・箇条書き・コードブロックが正しくレンダリングされなければならない。
2. 画像をドラッグ&ドロップした場合、説明に埋め込まれ、元ファイルは安全にストレージへ保存されなければならない。
3. 5MBを超える単一ファイルはアップロードできてはならない。
4. プレビューと編集の表示は切替え可能で、状態はユーザーごとに記憶されなければならない。

##### Requirment 4
**User Story:** ステークホルダーとして、読みやすいカードで項目の要点（タイトル、優先度、見積り、ラベル、期日）を一目で把握できる。意思決定を素早く行うため。

###### Acceptance Criteria
1. 一覧はカード表示で、タイトル・優先度・見積り・期日・色ラベルが既定順序で配置されなければならない。
2. 画面幅が狭い場合、重要度の低い補助情報は折りたたまれ、主要情報は常に表示されなければならない。
3. 期日が今日以前の項目は、落ち着いた警告トーンで目立たせなければならない。
4. 読み上げ支援技術でカード内情報の順序が論理的に伝達されなければならない。

---

#### Epic 2
優先順位付け・並び替え・価値の可視化

##### Requirment 5
**User Story:** プロダクトマネージャーとして、ドラッグ&ドロップで項目の並び順を変更できる。上位から順に着手するため。

###### Acceptance Criteria
1. ユーザーがカードをドラッグした場合、並び替えは100ms以内に視覚フィードバックを返さなければならない。
2. 並び順の変更は自動保存され、ページ再読込後も順序が保持されなければならない。
3. 並び替え操作が競合した場合、最後に確定した順序が適用され、他ユーザーにはソフトリフレッシュで反映されなければならない。
4. 並び替え不可の固定項目（例：ヘッダー）はドロップターゲットとして動作してはならない。

##### Requirment 6
**User Story:** プロダクトマネージャーとして、優先度（High/Medium/Low）を設定できる。関係者の合意を取りやすくするため。

###### Acceptance Criteria
1. 優先度は3段階で選択でき、各段階は既定の色トーンで表示されなければならない。
2. 優先度がHighの項目は一覧の先頭セクションに自動で集約表示できなければならない。
3. 優先度変更時、関連通知の購読者に更新が配信されなければならない。
4. 優先度が未設定の項目は、レポートから「不備あり」として抽出できなければならない。

##### Requirment 7
**User Story:** プロダクトマネージャーとして、簡易スコア（ビジネス価値、緊急度、リスク低減）で総合点を算出できる。客観性を高めるため。

###### Acceptance Criteria
1. 各要素は1〜5で入力でき、総合点は即時計算されなければならない。
2. 総合点が同点の場合、期日が早い方が上位に表示されなければならない。
3. スコアが未入力の場合、総合点は計算されてはならない。
4. エクスポート時にスコア内訳が列として出力されなければならない。

##### Requirment 8
**User Story:** ステークホルダーとして、上位N件のみをハイライト表示で確認できる。限られた時間で判断するため。

###### Acceptance Criteria
1. ユーザーが上位件数を設定した場合、対象以外は淡色化され、対象は強調されなければならない。
2. 淡色化してもテキストのコントラスト比は基準を満たさなければならない。
3. 件数設定はビューごとに保存され、個人設定として保持されなければならない。
4. ハイライトは印刷モードでも認識できなければならない。

---

#### Epic 3
見積り・スプリント計画との連携

##### Requirment 9
**User Story:** スクラムマスターとして、ストーリーポイントで見積りを付与できる。計画精度を上げるため。

###### Acceptance Criteria
1. 見積りは0, 0.5, 1, 2, 3, 5, 8, 13のプリセットから選択できなければならない。
2. 見積りが未設定の項目は「見積り待ち」としてフィルタ可能でなければならない。
3. 見積り変更時には変更者・時刻・前後値を履歴に残さなければならない。
4. 合計ポイントは一覧フッターに自動集計表示されなければならない。

##### Requirment 10
**User Story:** スクラムマスターとして、バックログからスプリントへ複数項目を一括で移動できる。計画を効率化するため。

###### Acceptance Criteria
1. 複数選択後の「スプリントに追加」で、対象スプリントを選べるダイアログが表示されなければならない。
2. キャパシティ超過が見込まれる場合、事前に警告が表示されなければならない。
3. 移動後はバックログとスプリントの両方で即時反映されなければならない。
4. 既に別スプリントに属する項目は重複追加されてはならない。

##### Requirment 11
**User Story:** プロダクトマネージャーとして、見積り確度（High/Medium/Low）を記録できる。不確実性を共有するため。

###### Acceptance Criteria
1. 確度は見積りと独立した属性として保持されなければならない。
2. 確度がLowの場合、カード上に軽い注意アイコンが表示されなければならない。
3. レポートで確度別の総ポイントを集計できなければならない。
4. 確度未設定は「レビュー対象」に自動分類されなければならない。

##### Requirment 12
**User Story:** スクラムマスターとして、依存関係を登録できる。順序の誤りを避けるため。

###### Acceptance Criteria
1. 項目同士の「ブロックする／される」関係を追加でき、カードにピル表示されなければならない。
2. 依存が未解決の項目はスプリント追加時に確認が求められなければならない。
3. 循環参照は作成できてはならない。
4. 依存の可視化ビューで、未解決の依存が上位に並ぶよう表示されなければならない。

---

#### Epic 4
ビュー・検索・フィルタリング・保存ビュー

##### Requirment 13
**User Story:** チームメンバーとして、担当者・ラベル・優先度・見積りで項目をフィルタできる。目的の情報に素早く到達するため。

###### Acceptance Criteria
1. 条件の追加・削除はタグ式UIで行え、適用中の条件が常に可視でなければならない。
2. 条件を1つも指定しない場合、全件が表示されなければならない。
3. フィルタはURLクエリに反映され、共有リンクで同じ状態を再現できなければならない。
4. フィルタ適用中は件数バッジが表示されなければならない。

##### Requirment 14
**User Story:** ステークホルダーとして、保存ビュー（例：今四半期の上位案件）を作成・共有できる。定例レビューを円滑にするため。

###### Acceptance Criteria
1. 現在の並び・フィルタ・ハイライト設定を「ビューとして保存」できなければならない。
2. 保存ビューはリンク共有と権限（公開／チーム内／個人）を設定できなければならない。
3. ビューの表示名と説明は編集でき、変更は直ちに反映されなければならない。
4. 削除された保存ビューのURLにアクセスした場合、適切な案内と既定ビューへの導線を表示しなければならない。

##### Requirment 15
**User Story:** チームメンバーとして、全文検索でタイトルと説明から項目を探せる。情報探索を効率化するため。

###### Acceptance Criteria
1. 入力中にサジェストが表示され、最近の検索語が履歴として提示されなければならない。
2. 検索は前方・部分一致に対応し、結果は一致率順で並べ替えられなければならない。
3. 検索語が空の場合、検索は実行されてはならない。
4. 検索結果ゼロの場合、代替の絞り込み例を案内しなければならない。

##### Requirment 16
**User Story:** ステークホルダーとして、印刷やPDF出力でも読みやすいレイアウトを選べる。会議配布資料に使うため。

###### Acceptance Criteria
1. 印刷モードでは背景装飾を簡素化し、テキスト・罫線・ラベルの可読性が維持されなければならない。
2. 改ページ位置はカード単位を優先し、カードの途中で分割されてはならない。
3. 生成されたPDFはA4縦・余白既定で1ページあたり少なくとも10件を表示できなければならない。
4. ダークモード利用時でも印刷はライト配色で出力されなければならない。

---

#### Epic 5
コラボレーション・権限・通知

##### Requirment 17
**User Story:** チームメンバーとして、コメントと@メンションで議論できる。意思疎通を明確にするため。

###### Acceptance Criteria
1. コメント投稿後、対象者に通知が送付されなければならない。
2. コメントは編集・削除でき、削除時はプレースホルダーで痕跡を残さなければならない。
3. 画像・コードスニペットを含むコメントもプレビュー可能でなければならない。
4. スパム検知に該当するコメントは投稿できてはならない。

##### Requirment 18
**User Story:** 管理者として、ロールごとに編集・閲覧・共有権限を制御できる。情報保護のため。

###### Acceptance Criteria
1. 権限は「閲覧・コメント・編集・管理」の段階で設定できなければならない。
2. 個別項目の共有設定で、チーム外ユーザーには期限付きリンクのみ許可されなければならない。
3. 権限変更は即時に適用され、監査ログに記録されなければならない。
4. 権限不足の操作はUIで非活性表示され、試行しても実行されてはならない。

##### Requirment 19
**User Story:** ステークホルダーとして、重要な変更（優先度変更、期日変更、スプリント移動）の通知を購読できる。情報の取りこぼしを防ぐため。

###### Acceptance Criteria
1. 通知チャネルはアプリ内・メール・Webhookから選択できなければならない。
2. 重大変更時は数分以内に通知が配信されなければならない。
3. 通知には変更前後の値と変更者が含まれていなければならない。
4. サイレント時間帯を設定した場合、その時間帯は通知が配信されてはならない。

##### Requirment 20
**User Story:** プロダクトマネージャーとして、変更履歴を時系列で確認できる。レビューと監査のため。

###### Acceptance Criteria
1. 各項目の履歴タイムラインで、フィールド単位の差分が可視化されなければならない。
2. 履歴は最大2年分を保持し、CSVとしてエクスポートできなければならない。
3. 機密フィールドは履歴の値をマスクしなければならない。
4. 大量履歴の読み込みはページネーションで3秒以内に初期表示されなければならない。

---

#### Epic 6
デザイン・配色・アクセシビリティ（「親しみ感のある落ち着いた明るい色合い」）

##### Requirment 21
**User Story:** デザイナーとして、親しみやすく落ち着いた明るい配色パレット（トークン）を製品全体で再利用できる。統一感を保つため。

###### Acceptance Criteria
1. カラートークン（例：`--color-bg-soft`, `--color-surface`, `--color-accent`, `--color-info`, `--color-warning`, `--color-danger`）が提供され、バックログUIはこれのみを参照しなければならない。
2. 背景系トークンは高明度・低彩度域に限定され、テキストのコントラスト比が少なくとも4.5:1を満たさなければならない。
3. アクセント色は1系統に抑え、状態色（情報・警告・危険）はアクセントと同時使用時にも識別可能でなければならない。
4. 主要要素のホバー・フォーカス時は、落ち着いた強調（シャドウまたは明度差）で表現されなければならない。

##### Requirment 22
**User Story:** デザイナーとして、色覚多様性に配慮した状態表現を提供できる。誰にとっても判読しやすくするため。

###### Acceptance Criteria
1. 重要状態は色だけでなくアイコン・テキスト・パターンで併用表示されなければならない。
2. シミュレーション（例：Protanopia/Deuteranopia）で重要状態が区別できなければならない。
3. 優先度やタグの色が同系統の場合、境界線やパターンで見分けられなければならない。
4. カラー切替を無効にする設定は提供されてはならない。

##### Requirment 23
**User Story:** ユーザーとして、明るい落ち着きのテーマを既定としつつ、ダークテーマも選択できる。利用環境に合わせるため。

###### Acceptance Criteria
1. テーマはアプリ設定から切替でき、直近の選択が次回以降も保持されなければならない。
2. OSのカラースキームに追従する自動設定を選べるようにしなければならない。
3. ダークテーマでもコントラスト比基準を満たし、警告色が過度に刺激的になってはならない。
4. 印刷・PDFは常にライトテーマの配色で出力されなければならない。

##### Requirment 24
**User Story:** デザイナーとして、タップ／クリック時のマイクロインタラクションを穏やかなモーションで表現できる。安心感を担保するため。

###### Acceptance Criteria
1. 主要操作のトランジションは200–250msの範囲で、急激なイージングを使用してはならない。
2. 動きはOSの「動きを減らす」設定に従い、無効化できなければならない。
3. 成功・警告・エラーのフィードバックはモーションと色の併用で、過剰な点滅を含んではならない。
4. モーションの有無で情報量が変わらないよう、静的代替表現を提供しなければならない。

---

#### Epic 7
インポート／エクスポート・外部連携

##### Requirment 25
**User Story:** プロダクトマネージャーとして、CSV/JSONでバックログをインポートできる。他ツールから移行するため。

###### Acceptance Criteria
1. サンプルテンプレートをダウンロードでき、列マッピングがUIで設定できなければならない。
2. 必須列が欠落している場合、取込は実行されてはならない。
3. 取り込み結果はサマリー（成功数・失敗数・理由）として表示されなければならない。
4. 失敗行は修正して再取込できなければならない。

##### Requirment 26
**User Story:** スクラムマスターとして、バックログをCSV/PDFにエクスポートできる。社内共有のため。

###### Acceptance Criteria
1. 現在のフィルタ・並び順を保持してエクスポートされなければならない。
2. PDFは配布に適したタイポグラフィと余白で出力されなければならない。
3. 機密フィールドはマスクするオプションを提供しなければならない。
4. エクスポート履歴は直近20件を保持し、再ダウンロードできなければならない。

##### Requirment 27
**User Story:** 管理者として、外部トラッカー（例：Jira/Trello）と片方向または双方向で同期できる。既存運用と併用するため。

###### Acceptance Criteria
1. 同期はプロジェクト単位で設定でき、項目のタイトル・説明・優先度・見積り・ステータスが対象でなければならない。
2. 双方向同期時、衝突が発生した場合は最終更新側が優先され、差分が履歴に記録されなければならない。
3. 非対応フィールドは同期対象として選択できてはならない。
4. 同期エラー時は管理者へ通知され、再試行が実行されなければならない。

##### Requirment 28
**User Story:** 開発者として、APIでバックログ項目を作成・取得・更新できる。自動化のため。

###### Acceptance Criteria
1. APIは認可トークンを必須とし、権限に応じたアクセス制御を適用しなければならない。
2. レートリミット超過時は標準化されたエラーでリトライ後待ち時間を返さなければならない。
3. APIスキーマはOpenAPIで公開され、サンプルが提供されなければならない。
4. 監査ログにAPI呼び出し元と操作が記録されなければならない。

---

#### Epic 8
品質・非機能・国際化

##### Requirment 29
**User Story:** プロダクトマネージャーとして、主要操作が体感即応で動作する。集中を妨げないため。

###### Acceptance Criteria
1. 一覧の初回表示は3秒以内、以降の操作は500ms以内のフィードバックを返さなければならない。
2. 1万件の項目が存在しても仮想リストで滑らかにスクロールできなければならない。
3. サーバ障害時は読み込みプレースホルダーを表示し、復旧後に自動再取得しなければならない。
4. クライアントエラーはユーザーに過度な技術用語を見せてはならない。

##### Requirment 30
**User Story:** 監査担当として、操作の監査証跡を取得できる。コンプライアンスのため。

###### Acceptance Criteria
1. 重要操作（作成・編集・削除・同期・権限変更）は監査ログに記録されなければならない。
2. 監査ログは期間・ユーザー・操作種別で検索できなければならない。
3. 監査ログはエクスポートでき、改ざん防止のためハッシュが付与されなければならない。
4. 個人情報は必要最小限で記録され、マスキングが適用されなければならない。

##### Requirment 31
**User Story:** ユーザーとして、日本語を既定として多言語表示にも対応できる。グローバル利用に備えるため。

###### Acceptance Criteria
1. 文言は国際化キーで管理され、ロケール切替で即時反映されなければならない。
2. 日付・数値・通貨はロケールに沿って整形されなければならない。
3. 翻訳が未提供のキーは既定言語でフォールバックしなければならない。
4. 右から左への書字系に切替時、レイアウトが破綻してはならない。

##### Requirment 32
**User Story:** セキュリティ担当として、データが安全に保護される。信頼を維持するため。

###### Acceptance Criteria
1. 通信はTLSで暗号化され、保存時の機密データは暗号化されなければならない。
2. 権限のないユーザーはAPI・UIいずれからも項目データにアクセスできてはならない。
3. セッションは一定時間の無操作で失効し、再認証が必要でなければならない。
4. 主要脆弱性（XSS/CSRF/SQLi）は対策が実装され、定期的に検査されなければならない。

