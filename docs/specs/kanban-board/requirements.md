# Requirements Document

## Introduction

本ドキュメントは、親しみ感のある落ち着いた明るい色合いで利用できるカンバンボードの要件を定義します。  
エピックを起点に、スプリントで完了可能なユーザーストーリーへ分解し、各ストーリーに対してEARS表記の受け入れ基準を付与します。

## Requirments

#### Epic 1
親しみ感×落ち着いた明るさのビジュアルテーマ

##### Requirment 1
**User Story:** ボード利用者として、温かみのある明るい配色プリセットを選べることで、安心感と可読性の高い見た目で作業できる。

###### Acceptance Criteria
1. ユーザーが「サンライト」「ティーラテ」「ミストグリーン」等のプリセットを選択した場合、全UIトークン（背景/面/境界/テキスト/アクセント）が即時に適用されなければならない。
2. 初回利用時、システムはデフォルトで落ち着いた明るさのプリセットを適用しなければならない。
3. プリセット切替中、システムは画面の点滅や急激なコントラスト変化を発生させてはならない。
4. プリセットが未保存状態のとき、システムは離脱前に保存確認を提示しなければならない。
5. プリセット選択後かつボード再訪時、システムは最後に選んだプリセットを自動復元しなければならない。

##### Requirment 2
**User Story:** ボード利用者として、アクセント色と中間トーンを微調整できることで、ブランドや個人の好みに寄せられる。

###### Acceptance Criteria
1. ユーザーが色スライダー/数値で調整した場合、システムはプレビュー領域と主要UIへ200ms以内で反映しなければならない。
2. 調整中、システムは最小コントラスト比（本文4.5:1、UI要素3:1）を下回る組み合わせを警告しなければならない。
3. 警告が表示されている間、システムは保存操作を許可してはならない。
4. ユーザーが「元に戻す」を選んだ場合、直前の値に戻らなければならない。
5. ユーザーが「デフォルトに戻す」を選んだ場合、プリセット既定値へ復元しなければならない。

##### Requirment 3
**User Story:** ボード利用者として、OSの外観設定に合わせてライト/ダークを自動切替できることで、目の負担を減らせる。

###### Acceptance Criteria
1. OSがライトのとき、システムはライトテーマを適用しなければならない。
2. OSがダークのとき、システムは低コントラストになり過ぎないダークテーマ（明度差確保）を適用しなければならない。
3. ユーザーが自動切替をオフにした場合、システムはユーザー選択のテーマを固定しなければならない。
4. 切替時、システムはアニメーションの継続時間を150–250msに制限しなければならない。
5. 切替直後かつ印刷操作が実行される場合、システムはライトテーマで印刷用スタイルを適用しなければならない。

##### Requirment 4
**User Story:** 色覚多様性に配慮したパレットを選べることで、誰もがステータスの違いを識別できる。

###### Acceptance Criteria
1. ユーザーが色覚配慮モードを有効化した場合、システムは赤/緑依存を避ける組み合わせと模様/アイコンの二重符号化を適用しなければならない。
2. 状態色が判別困難な場合、システムは形状（下線/パターン）やアイコンで補助しなければならない。
3. 状態ラベルが非表示のとき、システムはツールチップで文言を提示しなければならない。
4. 印刷/エクスポート時、システムはパターンとアイコンを保持しなければならない。
5. ボード上の凡例を開いた場合、システムは全状態の色/形/意味を一覧表示しなければならない。

---

#### Epic 2
カンバン基本操作（カード/列/ドラッグ&ドロップ/編集）

##### Requirment 5
**User Story:** ボード利用者として、カードを列間でドラッグ&ドロップできることで、作業進捗を直感的に更新できる。

###### Acceptance Criteria
1. ユーザーがカードをドラッグ開始した場合、システムは元位置のプレースホルダーと影の少ないリフト効果を表示しなければならない。
2. ドロップ先が無効のとき、システムはドロップを受け付けてはならない。
3. ドロップ後、システムは状態変更を200ms以内に反映しなければならない。
4. ドロップ直後に取り消しを選んだ場合、システムは元の位置へ戻さなければならない。
5. 同一列内の並び替え時、システムは近接インジケータで挿入位置を示さなければならない。

##### Requirment 6
**User Story:** ボード利用者として、カードを素早く作成/編集できることで、入力の負担を減らせる。

###### Acceptance Criteria
1. ユーザーが「＋」またはショートカットを押下した場合、システムはインライン作成フィールドを開かなければならない。
2. タイトルのみ入力で保存した場合、システムはカードを作成し詳細は後編集可能にしなければならない。
3. 編集フォームが開いている間、システムは自動保存を5秒ごとに実施しなければならない。
4. 保存失敗時、システムはエラーを表示し、再試行/下書き保持を提供しなければならない。
5. 連続作成モードが有効のとき、保存後に新規フィールドへフォーカスを遷移しなければならない。

##### Requirment 7
**User Story:** キーボード操作で移動や編集ができることで、操作効率を高められる。

###### Acceptance Criteria
1. フォーカスがカード上のとき、矢印キーで上下移動できなければならない。
2. 修飾キー＋矢印で列間移動できなければならない。
3. Enterで編集、Escで編集破棄ができなければならない。
4. ショートカット一覧を開いた場合、システムは現在の割り当てを表示しなければならない。
5. フォーカス可視リングは常に明確でなければならない。

##### Requirment 8
**User Story:** 直前操作の取り消し/やり直しができることで、安心して編集できる。

###### Acceptance Criteria
1. 取り消しを実行した場合、システムは直前の変更をローカル状態から即時に反映しなければならない。
2. 取り消し後、やり直しが可能でなければならない。
3. サーバー反映済みの場合でも、システムは楽観的更新を逆適用して矛盾なく表示しなければならない。
4. 履歴が空のとき、取り消し/やり直しは実行されてはならない。
5. 履歴は画面遷移後も同一セッション内で保持されなければならない。

---

#### Epic 3
視覚メタファと情報表現（タグ/期限/担当/チェックリスト）

##### Requirment 9
**User Story:** ボード利用者として、タグとバッジでカードの属性をひと目で把握できる。

###### Acceptance Criteria
1. ユーザーがタグを追加した場合、システムはタグ色とテキストをカード上に表示しなければならない。
2. タグが増えた場合、システムは溢れたタグを「＋N」で畳み、ホバーで展開しなければならない。
3. 同名タグの色はボード全体で一貫していなければならない。
4. タグを外した場合、システムはカード上から即時に除去しなければならない。
5. 印刷/エクスポート時、タグ名はテキストとして保持されなければならない。

##### Requirment 10
**User Story:** ボード利用者として、期限の近さを穏やかな色調で示してもらえることで、焦らず優先度を判断できる。

###### Acceptance Criteria
1. 期限が本日以降3日以内の場合、システムは穏やかな強調色で期限バッジを表示しなければならない。
2. 期限超過の場合、システムは明度を抑えた警告色＋アイコンを表示しなければならない。
3. 期限未設定の場合、システムは中立の表示で占有してはならない。
4. カレンダーから期限変更した場合、表示は即時更新されなければならない。
5. 色覚配慮モード時、色に加えて警告アイコン/下線を併用しなければならない。

##### Requirment 11
**User Story:** ボード利用者として、担当者アバターで責任の所在を素早く確認できる。

###### Acceptance Criteria
1. 担当者が設定された場合、システムはアバター/イニシャルをカードに表示しなければならない。
2. 担当者が複数の場合、最大3名を表示し、残りは「＋N」で畳まなければならない。
3. 担当者未設定のとき、システムは「未割当」バッジを表示しなければならない。
4. アバターにフォーカスした場合、システムはユーザー名をツールチップ表示しなければならない。
5. 非公開ユーザーのとき、システムはイニシャルのみを表示し、個人情報を表示してはならない。

##### Requirment 12
**User Story:** ボード利用者として、チェックリストで小タスクの進捗を可視化できる。

###### Acceptance Criteria
1. チェック数/総数が更新された場合、システムは進捗バッジ（例: 2/5）をカードに表示しなければならない。
2. すべて完了した場合、システムは完了アイコンを表示し色調をわずかに明るくしなければならない。
3. 未完了がある場合、システムは過剰な警告色を用いてはならない。
4. 詳細パネルでチェック項目を並び替えた場合、順序はカード表示に即時反映されなければならない。
5. 項目が0件のとき、進捗バッジは表示されてはならない。

---

#### Epic 4
検索・フィルタ・並び替え・ビュー保存

##### Requirment 13
**User Story:** ボード利用者として、タイトル/説明/タグを横断検索できることで、目的のカードをすぐに見つけられる。

###### Acceptance Criteria
1. ユーザーが検索語を入力した場合、システムは300ms以内に結果をハイライトしなければならない。
2. 大文字小文字は区別されてはならない。
3. 検索結果が0件のとき、システムは代替提案（タグ/担当/期限）を提示しなければならない。
4. 検索語をクリアした場合、フィルタは解除されなければならない。
5. 日本語の全角/半角・かな/カナ差は正規化して一致しなければならない。

##### Requirment 14
**User Story:** ボード利用者として、担当者/タグ/期限でフィルタできることで、今必要な作業に集中できる。

###### Acceptance Criteria
1. フィルタを追加した場合、システムはAND/ORの条件をUIで明示しなければならない。
2. 条件が複数ある場合、システムはチップで列挙し、個別に除去できなければならない。
3. フィルタ適用中、システムは適用件数の要約を表示しなければならない。
4. フィルタにより列が空になった場合、システムは空状態の説明を表示しなければならない。
5. フィルタを解除した場合、直前のスクロール位置と展開状態を保持しなければならない。

##### Requirment 15
**User Story:** ボード利用者として、期限/優先度/更新日時で並び替えできることで、作業順を調整できる。

###### Acceptance Criteria
1. 並び替え基準を選択した場合、システムは対象列内の順序を即時更新しなければならない。
2. 昇順/降順の切替が可能でなければならない。
3. 手動並び替えが直近で行われた場合、システムは手動順を優先する設定を保持しなければならない。
4. 並び替え適用中、ドラッグ&ドロップでの位置変更はローカル優先で反映されなければならない。
5. 並び替え解除時、元の順序に復元されなければならない。

##### Requirment 16
**User Story:** ボード利用者として、検索/フィルタ/並び替えの組み合わせをビューとして保存/共有できることで、再利用できる。

###### Acceptance Criteria
1. ユーザーが現在の条件を「ビューとして保存」した場合、システムは名前と可視性（個人/共有）を設定させなければならない。
2. 共有ビューを開いた場合、システムは作成者と更新日時を表示しなければならない。
3. 参照権限がないユーザーは共有ビューを閲覧できてはならない。
4. ビュー削除時、システムは確認ダイアログを表示しなければならない。
5. ビュー適用中、上書き保存が可能でなければならない。

---

#### Epic 5
レイアウトとレスポンシブ/モバイル操作/スイムレーン

##### Requirment 17
**User Story:** ボード利用者として、列幅を自動最適化しつつ必要に応じて手動調整できることで、見やすく整えられる。

###### Acceptance Criteria
1. 画面幅が変更された場合、システムは列幅を自動再計算しなければならない。
2. ユーザーがリサイズハンドルをドラッグした場合、システムは隣接列と折り返しルールを保ちながら変更しなければならない。
3. 最小/最大幅の範囲外へはリサイズできてはならない。
4. 手動調整後、システムは設定をボード単位で記憶しなければならない。
5. 列が多数で横スクロールが必要な場合、システムはヘッダーを固定表示しなければならない。

##### Requirment 18
**User Story:** ボード利用者として、横/縦スクロールとスナップで視点を保ちながら閲覧できる。

###### Acceptance Criteria
1. ユーザーがホイール/トラックパッドでスクロールした場合、システムは慣性とスナップ位置を適切に適用しなければならない。
2. 列ヘッダーをクリックした場合、システムは列先頭へスムーズスクロールしなければならない。
3. スクロール中のドラッグは、オートスクロールで境界を越えて移動できなければならない。
4. モバイルでプルダウンした場合、システムは更新アクションを表示しなければならない。
5. スクロール位置はボード再訪時に復元されなければならない。

##### Requirment 19
**User Story:** モバイル利用者として、タッチジェスチャでドラッグ/詳細開閉/クイックアクションができることで、片手で操作できる。

###### Acceptance Criteria
1. 長押し開始時、システムはドラッグハンドルを表示しなければならない。
2. スワイプした場合、システムはクイックアクション（担当/期限/移動）を表示しなければならない。
3. タップで詳細を開いた場合、戻る操作で直前の位置へ復帰しなければならない。
4. 誤操作を防ぐため、スワイプ感度はOSのアクセシビリティ設定に追従しなければならない。
5. 画面幅が狭い間、ツールチップは押しやすいポップオーバーで代替されなければならない。

##### Requirment 20
**User Story:** ボード利用者として、スイムレーンでグループ（例: プロジェクト/優先度/担当）を横断表示できることで、俯瞰できる。

###### Acceptance Criteria
1. ユーザーがグループ軸を選択した場合、システムは各列内をレーンで区切って表示しなければならない。
2. レーンが空の場合、システムは空状態を表示しなければならない。
3. レーン間のドラッグは許可されなければならない。
4. レーン折りたたみ時、総数バッジを維持しなければならない。
5. スイムレーン設定はビューと一緒に保存されなければならない。

---

#### Epic 6
WIP（仕掛かり）制限とポリシー

##### Requirment 21
**User Story:** 管理者として、列ごとにWIP上限を設定できることで、流れを最適化できる。

###### Acceptance Criteria
1. 管理者がWIP数を設定した場合、システムは列ヘッダーに上限を表示しなければならない。
2. WIPが未設定の列では制限が適用されてはならない。
3. WIP変更後、既存カード数が上限を超える場合、システムは警告を表示しなければならない。
4. 不正な値（負数/小数）は保存されてはならない。
5. 設定は監査ログに記録されなければならない。

##### Requirment 22
**User Story:** ボード利用者として、WIP超過を穏やかな表現で気づけることで、ストレスなく調整できる。

###### Acceptance Criteria
1. 超過時、システムは列ヘッダーを穏やかな警告色とアイコンで示さなければならない。
2. 超過状態の間、システムは列の追加作成ボタンを非活性にしなければならない。
3. 超過が解消された場合、システムは表示を自動で通常に戻さなければならない。
4. 色覚配慮モード時、色に加えて警告パターンを表示しなければならない。
5. 通知を有効にしている場合、超過時に非破壊トーストで知らせなければならない。

##### Requirment 23
**User Story:** 管理者として、強制制限/例外許可のポリシーを切替えられることで、現場の事情に対応できる。

###### Acceptance Criteria
1. ポリシーが「強制」の場合、超過ドロップは実行されてはならない。
2. ポリシーが「例外許可」の場合、システムは理由の入力を要求しなければならない。
3. 例外記録は履歴に残り、後で確認できなければならない。
4. ポリシー変更時、システムは対象列へ即時適用しなければならない。
5. ポリシーの既定はボードテンプレートで定義できなければならない。

##### Requirment 24
**User Story:** ボード利用者として、WIPの状況をヒートマップで俯瞰できることで、ボトルネックを見つけられる。

###### Acceptance Criteria
1. ヒートマップを有効化した場合、システムは列ごとの充足率を段階的な明度で表示しなければならない。
2. 充足率が高い場合でも、過度に攻撃的な色調を使用してはならない。
3. ホバー/フォーカス時、システムは数値（例: 7/5, 140%）を表示しなければならない。
4. 印刷/エクスポート時、ヒートマップ凡例を含めなければならない。
5. ヒートマップは色覚配慮モードでパターン併用に切り替わらなければならない。

---

#### Epic 7
フィードバック/アニメーション/トースト（穏やかなモーション）

##### Requirment 25
**User Story:** ボード利用者として、ドラッグ&ドロップ時に控えめなアニメーションで動きが分かることで、疲れにくい操作感を得られる。

###### Acceptance Criteria
1. ドラッグ中、システムは影/拡大を抑えたリフトとスナップアニメーション（150–250ms）を適用しなければならない。
2. 高減衰アニメーション設定が有効のとき、システムは移動距離/時間をさらに短縮しなければならない。
3. アニメーションが無効設定のとき、システムは遷移効果を表示してはならない。
4. 低性能環境では、システムは自動的にアニメーションの詳細度を下げなければならない。
5. アニメーション適用中でも、入力はブロックされてはならない。

##### Requirment 26
**User Story:** ボード利用者として、保存/失敗/制限の状態を非破壊トーストで知ることで、作業を中断せずに把握できる。

###### Acceptance Criteria
1. 保存成功時、システムは自動消滅するトーストを表示しなければならない。
2. 失敗時、トーストは再試行アクションを含まなければならない。
3. WIP超過などの制限時、トーストは原因と解決手段へのリンクを含めなければならない。
4. トーストの表示時間はユーザー設定に従わなければならない。
5. 画面読み上げが有効のとき、トーストはライブリージョンで読み上げられなければならない。

##### Requirment 27
**User Story:** ボード利用者として、危険な操作の前にやさしい確認があることで、誤操作を避けられる。

###### Acceptance Criteria
1. ユーザーがカード削除を実行した場合、システムは確認ダイアログを表示しなければならない。
2. ダイアログにおいて、システムはデフォルトを「キャンセル」に設定しなければならない。
3. 復元可能期間内、システムは取り消し操作で復旧できなければならない。
4. 連続削除中、システムは一括取り消しを提供しなければならない。
5. アクセシビリティ設定が有効のとき、確認テキストは簡潔な読み上げ用ラベルを持たなければならない。

##### Requirment 28
**User Story:** ボード利用者として、操作音の有無を切り替えられることで、静かな環境でも配慮できる。

###### Acceptance Criteria
1. 操作音がオンのとき、ドロップ/保存/警告に短い効果音を再生しなければならない。
2. サイレントモードでは音を再生してはならない。
3. 音量はOS設定に追従しなければならない。
4. 音が再生できない環境では、システムは視覚的フィードバックのみを表示しなければならない。
5. 設定はボードごとに記憶されなければならない。

---

#### Epic 8
パフォーマンス/永続化/オフライン・状態保持

##### Requirment 29
**User Story:** ボード利用者として、大量カードでも滑らかに操作できることで、ストレスなく管理できる。

###### Acceptance Criteria
1. カードが多数存在する間、システムはリスト仮想化で60fps目標を維持しなければならない。
2. スクロール中の画像/アイコンは遅延読み込みされなければならない。
3. 背景同期が実行中のとき、入力遅延を増加させてはならない。
4. パフォーマンス劣化を検知した場合、システムは軽量表示モードへ自動切替しなければならない。
5. 軽量表示時でも、重要なステータス情報は失われてはならない。

##### Requirment 30
**User Story:** ボード利用者として、楽観的更新で操作の反応が速いことで、待ち時間を感じにくい。

###### Acceptance Criteria
1. ユーザー操作直後、システムはサーバー応答前にUIを更新しなければならない。
2. サーバーエラー時、システムはUIを元に戻しエラー内容を提示しなければならない。
3. 競合が発生した場合、システムは差分を提示し解決を支援しなければならない。
4. 一貫性が保てない場合、システムは再同期を自動実行しなければならない。
5. 再同期中、システムは進行状況を非破壊で表示しなければならない。

##### Requirment 31
**User Story:** オフライン時でも作業を継続できることで、ネットワークに依存せずに更新できる。

###### Acceptance Criteria
1. ネットワークが切断された場合、システムはオフラインバナーを表示しなければならない。
2. オフライン中の変更はローカルにキューイングされなければならない。
3. 再接続時、システムはキューを順序通り同期しなければならない。
4. 同期に失敗した変更は個別に再試行できなければならない。
5. オフライン時、重いアセットの取得は試行してはならない。

##### Requirment 32
**User Story:** ボード利用者として、最後に見ていた場所やビューが保持されることで、再開がスムーズになる。

###### Acceptance Criteria
1. ボードを再訪した場合、システムは直前のスクロール位置・開いていた詳細・適用中ビューを復元しなければならない。
2. 別端末からアクセスした場合、システムはユーザー設定をサーバー側から復元しなければならない。
3. プライベートブラウズ時、システムはローカル保存を行ってはならない。
4. 復元に失敗した場合、システムは既定状態で開き、失敗を通知しなければならない。
5. 復元中、UIが操作不能になるべきではない。

